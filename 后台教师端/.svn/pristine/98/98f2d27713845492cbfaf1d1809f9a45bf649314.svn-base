<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/public.css">
    <link rel="stylesheet/less" href="css/public.less">
    <link rel="stylesheet" href="css/elementUi.css">
    <script src="js/less.min.js"></script>
</head>
<body>
<div id="loading">
</div>
<div class="main" style="display: none" id="academicPlanningReport" >
    <div class="zhutiLeft">
        <el-row class="tac">
            <el-col :span="12">
                <el-menu
                        default-active="2"
                        class="el-menu-vertical-demo"
                >
                    <el-submenu index="1">
                        <template slot="title">
                            <span>目标设定</span>
                        </template>
                        <el-menu-item-group>
                            <el-menu-item index="1-1"><a href="/career/careerAnchor.html">职业定位</a></el-menu-item>
                            <el-menu-item index="1-2"><a href="/career/university.html">院校定位</a></el-menu-item>
                            <el-menu-item index="1-3"><a href="/career/major.html">专业定位</a></el-menu-item>
                            <el-menu-item index="1-4"><a href="/career/goal.html">我的目标</a></el-menu-item>
                        </el-menu-item-group>
                    </el-submenu>
                    <el-submenu index="2">
                        <template slot="title">
                            <span>目标分解</span>
                        </template>
                        <el-menu-item-group>
                            <el-menu-item index="2-1"><a href="/career/decompose.html">目标分解</a></el-menu-item>
                        </el-menu-item-group>
                    </el-submenu>
                    <el-submenu index="3">
                        <template slot="title">
                            <span>行动计划</span>
                        </template>
                        <el-menu-item-group>
                            <el-menu-item index="3-1"><a href="/career/plan.html">行动计划</a></el-menu-item>
                        </el-menu-item-group>
                    </el-submenu>
                    <el-submenu index="4">
                        <template slot="title">
                            <span>学业规划报告</span>
                        </template>
                        <el-menu-item-group>
                            <el-menu-item index="4-1"><a href="/career/academicPlanningReport.html">学业规划报告</a></el-menu-item>
                        </el-menu-item-group>
                    </el-submenu>
                    <el-submenu index="5">
                        <template slot="title">
                            <span>学业规划</span>
                        </template>
                        <el-menu-item-group>
                            <el-menu-item index="5-1"><a href="/career/diagnosis/index.blade.php?studentId=">诊断</a></el-menu-item>
                            <el-menu-item index="6-2"><a href="/career/planning.html">规划</a></el-menu-item>
                            <el-menu-item index="7-3"><a href="/career/counseling.html">辅导</a></el-menu-item>
                            <el-menu-item index="8-4"><a href="/career/growthArchiveEntry.html">成长档案</a></el-menu-item>
                        </el-menu-item-group>
                    </el-submenu>
                </el-menu>
            </el-col>
        </el-row>
    </div>
    <div class="elective"  style="float:left;width:970px;">
        <div class="myReports">
            <div class="title">
                <img src="/career/imgs/careerArchives/icon_biaoti.png" alt="">
                学业规划报告
            </div>
            <ul class="electiveBox">
                <li>
                    <div class="left">
                        <img src="/career/imgs/careerManagement/academicPlanningReport/icon_head.png" alt="">
                    </div>
                    <div class="right">
                        <div class="title">
                            学业规划报告
                        </div>
                        <div class="buttons">
                            <div class="button" :style="{margin:(!isReport)&&'40px 20px'||''}" @click="createReport">
                                生成
                            </div>
                            <div class="button" v-if="isReport" @click="goReport(reportId)">
                                查看
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
            <div class="title">
                <img src="/career/imgs/careerArchives/icon_biaoti.png" alt="">
                历史记录
            </div>
            <table>
                <thead>
                <tr>
                    <td>名称</td>
                    <td>日期</td>
                    <td>查看</td>
                    <!--<td>下载</td>-->
                </tr>
                </thead>
                <tbody>
                <tr v-for="(item, index) in reportList" :key="index">
                    <td>学业规划报告</td>
                    <td>${item.createdAt}</td>
                    <td><span @click="goReport(item.id)">查看</span></td>
                    <!--<td>-->
                    <!--<span class="icon" @click="goReport(item.id,'下载')"></span>-->
                    <!--</td>-->
                </tr>
                </tbody>
            </table>
            <div class="noneContent" v-if="reportList.length==0"></div>
            <div class="page_box">
                <span>共${count}条</span>
                <el-pagination
                        background
                        layout="prev, pager, next"
                        :page-size="pageSize"
                        :total="count"
                        @current-change="currentChange"
                >
                </el-pagination>
            </div>

        </div>
    </div>
</div>
</body>
<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/vue.js"></script>
<script src="js/echarts.min.js"></script>
<script src="js/elementUi.js"></script>
<script src="js/axios.min.js"></script>
<script src="js/api/index.js"></script>
<script src="js/api/address.js"></script>
<script>
    Vue.prototype.ports = ports;
    Vue.prototype.$ajax= axios;
    Vue.prototype.$echarts =echarts;
    Vue.prototype.G_uri= address.G_uri;
    Vue.prototype.G_uris= address.G_uris;
    new Vue({
        delimiters:['${','}'],
        el:'.main',
        data(){
            return{
                // 报告数组
                reportList: [],
                // 报告共有多少条
                count: 0,
                // 报告一共有多少页
                totalPage: '',
                // 每页显示多少条
                pageSize: 7,
                // 当前页
                currentPage: 1,
                //是否生成过报告
                isReport:false,
                reportId:0
            }
        },
        methods:{
            //跳转测评
            jump(path){
                this.$router.push(path)
            },
            // 查看报告
            goReport(id,down) {
                window.open("academicPlanningReportDetail.html?id="+id,'_blank');
            },
            currentChange(currentPage) {
                this.currentPage = currentPage;
                this.history(currentPage);
            },
            //是否生成过报告
            isNo(){
                this.$ajax
                    .post(this.G_uri + this.ports.careerManagement.guihuabaogao.isNo,{
                        studentId:window.sessionStorage.getItem('studentId'),
                    },{
                        headers:{
                            token: window.sessionStorage.getItem('ymtxToken')
                        }
                    })
                    // 监听数据返回
                    .then(res=> {
                        if(res.data.code == 2000) {
                            let data = res.data.data;
                            if(data.id!=0){
                                this.isReport=true
                            }
                            this.reportId=data.id;
                        }else {

                        }
                    })
                    .catch(res=>  {
                        console.log(error);
                    })
            },
            //生成报告
            createReport(){
                this.$ajax
                    .post(this.G_uri + this.ports.careerManagement.guihuabaogao.storeReport,{
                        studentId:window.sessionStorage.getItem('studentId'),
                    },{
                        headers:{
                            token: window.sessionStorage.getItem('ymtxToken')
                        }
                    })
                    // 监听数据返回
                    .then(res=> {
                        if(res.data.code == 2000) {
                            this.isNo();
                            this.history()
                        }else {

                        }
                    })
                    .catch(error =>{
                        console.log(error);
                    })
            },
            //历史记录
            history(value){
                var pageNumber = value;
                var pageSize = this.pageSize;
                this.$ajax
                    .post(this.G_uri + this.ports.careerManagement.guihuabaogao.history,{
                        studentId:window.sessionStorage.getItem('studentId'),
                        pageNumber: pageNumber,
                        pageSize: pageSize,
                    },{
                        headers:{
                            token: window.sessionStorage.getItem('ymtxToken')
                        }
                    })
                    // 监听数据返回
                    .then(res=> {
                        if(res.data.code == 2000) {
                            let data=res.data.data;
                            if(data.list.length!=0){
                                this.reportList=data.list
                            }
                            this.totalPage = data.page.totalPage;
                            this.count = data.page.count;
                        }else {

                        }
                    })
                    .catch(error =>{
                        console.log(error);
                    })
            }
        },
        created() {
            this.isNo();
            this.history();
        },
        mounted(){
            setTimeout(function () {
                $('#loading').hide();
                $('.main').fadeIn();
            })
        }
    })
</script>
</html>
